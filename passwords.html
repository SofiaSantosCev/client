<!DOCTYPE html>
<html>
<head>
	<title>PASSWORDS</title>
	<link rel="stylesheet" type="text/css" href="main.css">
	<link rel="stylesheet" type="text/css" href="css/bootstrap.css">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
</head>
<body>
	<!-- NAVBAR -->
		<nav class="navbar bg-dark text-white">
			<a class="navbar-brand">GPASS</a>
			<a href="passwords.html">Passwords</a>
			<a href="categories.html">Categories</a>
			<a class="btn btn-default text-white my-2 my-sm-0" onclick="logOut()" href="login.html">Logout</a>
		</nav>


	<!-- CREATE PASSWORD -->
		<div id="container">
			<div class="container">
				<form id="form" class="form-inline">
					<div class="form-group mb-2">
						<input type="text" placeholder="new password title" required id="title" class="form-control">
					</div>
					<div class="form-group mb-2">
						<input type="text" placeholder="new password" required id="password" class="form-control">
					</div>
					<div class="form-group mb-2">
						<input type="text" placeholder="category" required id="category" class="form-control">
					</div>
					<button type="submit" onclick="create()" id="button" class="btn btn-warning">Create password</button>
					<p id="error" class="hidden, error"></p>	
				</form>
			</div>
			<!-- passwords LIST -->
			<div class="container">
				<table id="passwordList" class="table table-hover table-light" style="background-color: white" >
					<thead class="thead-light">
						<tr>
							<th scope="col">Title</th>
							<th scope="col">Encoded Password</th>
							<th scope="col">New title</th>
							<th scope="col">New password</th>
							<th scope="col">Category</th>
							<th scope="col"></th>
							<th scope="col"></th>
						</tr>
					</thead>
					<tbody>
						<!-- Filas de contraseÃ±as  -->
					</tbody>
				</table>
			</div>
		</div>
	
</body>

<script type="text/javascript">
	$("#form").submit(function(e){
		e.preventDefault();
	});
	var token = localStorage.getItem("token"); 
	var title = document.getElementById("title").value;
	//comprobar token

	$.ajax({
			url:"http://localhost/gpass-server/public/api/passwords",
			type: "GET",

			headers:{
				'Authorization' : token
			},

			success: function(response){
				var passwords = response.passwords;
				showPasswords(passwords);
			},
			
			error: function() {
				console.log("Error :(");
			}
		});

	function create() { 
		var title = $('#title').val();
		var password = $('#password').val();
		var category = $('#category').val();
		$.ajax({
			url:"http://localhost/gpass-server/public/api/passwords",
			type: "POST",

			headers: {
				'Authorization': token
			},

			data:{
				'title': title,
				'password':password,
				'category_id': category
			},

			success: function(response){
				var passwords = response.passwords;
				showPasswords(passwords);
			},
			
			error: function(response) {
				console.log(response.responseText);
			}
		});
	}


	function showPasswords(passwords){ 
			if(passwords == null){
			$('#passwordList').append('<div><p>Theres no passwords created yet</p></div>')
			}

			for(var password in passwords){
			$('#passwordsList').append('<tr><td>'+passwords[password].name+'</td><td><input type="text" class="form-control" id="newName'+passwords[password].id+'" value='+passwords[password].name+'></td><td><button  id="modifyButton" onclick="modify('+passwords[password].id+')" class="btn btn-primary">Modify</button></td><td><button id="blockButton'+passwords[password].id+'" onclick="delete('+passwords[password].id+')" class="btn btn-danger">Delete</button></td></tr>');
			}
        }

</script>
</html>
