<!DOCTYPE html>
<html>
	<head>
		<title>CATEGORY</title>
		<link rel="stylesheet" type="text/css" href="main.css">
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
	</head>
	<body>
		<img src="logo.png">
		<h1>CATEGORIES</h1>
		<form id="form">
			<input type="text" placeholder="new category name" required id="name"><br><br>
			<input type="submit" onclick="create()" value="crear categoria">	
		</form>

		<div id="categoriesList"></div>
		<p id="error" class="hidden, error"></p>
		
	</body>

	<script type="text/javascript">
		
		$("#form").submit(function(e){
			e.preventDefault();
		});

		if(!localStorage.getItem("token")){
       		window.location = 'login.html';
    	} 
		var token = localStorage.getItem("token");

		//comprobar token

		$.ajax({
			url:"http://localhost:8888/server/public/api/categories",
			type: "GET",

			headers:{
				'Authorization' : token
			},

			success: function(response){
				var categories = response.categories;
				var ids = response.ids;
				showCategories(categories, ids);
			},
				
			error: function(response) {
				console.log(response.responseJSON.text);
				$('#error').text(response.responseJSON.text);
				$('#error').removeClass('hidden');
			}
		});

		function create() { 
			var name = $('#name').val();
			$.ajax({
				url:"http://localhost:8888/server/public/api/categories",
				type: "POST",

				headers: {
					'Authorization': token
				},

				data:{
					'name': name,
				},

				success: function(response){
					location.reload();
					console.log(response.responseText);
				},
				
				error: function(response) {
					console.log(response.responseJSON.text);
					$('#error').text(response.responseJSON.text);
					$('#error').removeClass('hidden');
				}
			});
		}


		function showCategories(categories, ids){ 
			
			for(var category in categories) {
				$('#categoriesList').append('<div class="category" id="category'+ ids[category]+'"> '+ categories[category]+ '<button class="delBtn" id="categoryDelBtn'+ ids[category]+'" onClick="deleteCategory('+ids[category]+')">Borrar</button> <button class="modBtn" id="categoryModBtn'+ ids[category]+'" onClick="modifyCategory('+ids[category]+')">Modificar</button> </div> <br>');
            }
        }

	</script>
</html>
